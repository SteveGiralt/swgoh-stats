# SWGOH API Client - Project Context

## Project Overview
Python client for interacting with the Mhanndalorian Bot API to retrieve and analyze Star Wars Galaxy of Heroes data (Territory Wars, Guild info, Player data, etc.).

## Key Files
- `swgoh_api_client.py` - Main client with API calls and TW analysis
- `requirements.txt` - Dependencies (requests, pandas, python-dotenv)
- `.env` - API credentials (not in git)
- `.env.example` - Template for credentials
- `.gitignore` - Excludes .env and sensitive files
- `twlogs.json` - Sample TW logs data (ignored by git)
- `DEVELOPMENT_NOTES.md` - Critical data structure documentation
- `README.md` - User documentation

## Current Features

### API Endpoints
1. **twlogs** - Fetch TW logs from API
2. **player** - Get player profile and roster
3. **guild** - Get guild information
4. **guild-players** - Extract player list from guild
5. **analyze-tw** - Local analysis of TW logs (no API needed)

### TW Analysis Capabilities
- Parse TW logs JSON files
- Separate attacks by guild (our guild vs opponent)
- Track successful attacks (wins) per player
- Track defeats (losses) per player
- Display format: "wins/total" (e.g., "2/3" = 2 wins, 3 total, 1 loss)
- Calculate total banners earned
- Average banners per attack
- Average squad power used
- Sort by total banners descending

## Guild Configuration
- **Guild ID**: BQ4f8IJyRma4IWSSCurp4Q (default)
- **Guild Name**: DarthJedii56 (default)
- **Default Ally Code**: 657146191

## Environment Variables (.env file)

The project uses `python-dotenv` for automatic credential loading:

```bash
# .env file (created from .env.example)
SWGOH_API_KEY=your_api_key
SWGOH_DISCORD_ID=your_discord_id
```

**Setup:**
1. Copy `.env.example` to `.env`
2. Fill in your actual credentials
3. File is automatically loaded on script run
4. Credentials never committed to git (.gitignore)

## Important Lessons Learned

### Data Structure Gotchas
1. In SQUAD_WIN events, `info.authorName` is the ATTACKER (not defender!)
2. `zoneData.guildId` represents the ATTACKING guild (not defending!)
3. API responses are compressed - use `gzip,deflate` not `br`
4. TW logs output files include header text before JSON

### Analysis Logic
- Only SQUAD_WIN events are counted (successful attacks)
- Defeats are inferred by finding players as defenders in opponent attacks
- Guild separation based on `zoneData.guildId`

## Common Commands

```bash
# Get TW logs from API (no credentials needed - loaded from .env)
python swgoh_api_client.py --endpoint twlogs --output twlogs.json

# Analyze TW logs (automatically fetches guild name from API)
python swgoh_api_client.py --endpoint analyze-tw --input-file twlogs.json

# Get guild players
python swgoh_api_client.py --endpoint guild-players

# Get guild info (non-authenticated, safe to use during gameplay)
python swgoh_api_client.py --endpoint guild

# Get player info (non-authenticated, safe)
python swgoh_api_client.py --endpoint player --ally-code 657146191
```

## Development Workflow
1. Read `DEVELOPMENT_NOTES.md` for critical data structure info
2. Test changes with known verification points (tomasmm: 2/3, Exar Kun in our guild)
3. Update documentation when adding features
4. Use pandas for data analysis tasks

## Recent Updates (Latest First)

### Session 2 - Environment & Guild Name Automation
- ✅ Added `.env` file support with `python-dotenv`
- ✅ Automatic guild name extraction from `/guild` endpoint
- ✅ Removed manual `--guild-name` parameter
- ✅ Added API endpoint documentation
- ✅ Updated all documentation files

### Session 1 - Initial TW Analysis
- ✅ Created TW logs analysis with pandas
- ✅ Fixed attacker/defender field confusion
- ✅ Fixed guild assignment logic
- ✅ Added wins/total format (e.g., "2/3")
- ✅ Documented critical data structures

## Next Session TODO
- Consider extracting opponent guild name from data
- Add defense deployment tracking
- Zone-by-zone analysis capabilities
- Timeline analysis of attacks
- Implement other endpoints (/gac, /tb, /player roster analysis)
